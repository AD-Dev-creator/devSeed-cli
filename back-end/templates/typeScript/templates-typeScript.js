export const typeScriptTemplates = {
  //* File index.ts
  "src/index.ts": `import express from "express";
import cors from "cors";
import bodyParser from "body-parser";
import dotenv from "dotenv";
import { router } from "./routes";
import { swaggerUi, swaggerDocs } from "./common/utils/swagger";
import "./common/middleware/passport.config";
import passport from "passport";
  
dotenv.config();
  
export const app = express();
  
app.use(cors());
app.use(bodyParser.json());
app.use(passport.initialize());    
  
app.use("/api", router);
app.use("/api-docs", swaggerUi.serve, swaggerUi.setup(swaggerDocs));
  
const PORT = process.env.API_PORT || 3003;
  
app.listen(PORT, () => {
  console.log(\`Server running on port \${PORT}
    Documentation Swagger: http://localhost:\${PORT}/api-docs\`);
});`,

  //* File Routes
  "src/routes.ts": `import { Router } from "express";

export const router = Router();

// TODO: Define your routes here
`,

  //* File Database config
  "src/common/database/db.ts": `import { PrismaMariaDb } from "@prisma/adapter-mariadb";
import { PrismaClient } from "@prisma/client";
import dotenv from "dotenv";

dotenv.config();

const adapter = new PrismaMariaDb({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  connectionLimit: 5,
});

const prisma = new PrismaClient({ adapter });

export { prisma };
`,

  //* File Prisma config
  "prisma.config.ts": `// This file was generated by Prisma and assumes you have installed the following:
import "dotenv/config";
import { defineConfig, env } from "prisma/config";

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  datasource: {
    url: env("DATABASE_URL"),
  },
});
`,

  //* Prisma Schema file
  "prisma/schema.prisma": `// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Session {
  id String @id @default(uuid())

  token     String @unique @db.VarChar(500)
  accountId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expiresAt DateTime

  account Account @relation(fields: [accountId], references: [id])
}

model Account {
  id String @id @default(uuid())

  deletedAt DateTime?

  sessions Session[]
  role     Role

  admins Admin?
  users  User?
}

enum Role {
  ADMIN
  USER
}

model Admin {
  id String @id @default(uuid())

  name     String @unique @db.VarChar(30)
  email    String @unique @db.VarChar(50)
  password String @db.VarChar(255)

  isActive  Boolean @default(true)
  accountId String  @unique @db.VarChar(191)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  account Account @relation(fields: [accountId], references: [id])
}

model User {
  id String @id @default(uuid())

  email    String @unique @db.VarChar(30)
  name     String @unique @db.VarChar(50)
  password String @db.VarChar(255)

  isActive  Boolean @default(true)
  accountId String  @unique @db.VarChar(191)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  account Account @relation(fields: [accountId], references: [id])
}
`,

  //* File Passport config
  "src/common/middleware/passport.config.ts": `import passport from "passport";
import { Strategy as JwtStrategy, ExtractJwt } from "passport-jwt";
import { prisma } from "../database/db";

const options = {
  jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
  secretOrKey: process.env.JWT_SECRET || "default_secret",
};

passport.use(
  new JwtStrategy(options, async (jwtPayload, done) => {
    try {
      const account = await prisma.account.findUnique({
        where: { id: jwtPayload.id },
      });

      if (account) {
        return done(null, account);
      } else {
        return done(null, false);
      }
    } catch (error) {
      return done(error, false);
    }
  })
);
`,

  //* Auth Guard Middleware
  "src/common/middleware/guard/auth.guard.ts": `import { prisma } from "../database/db";
import { Request, Response, NextFunction } from "express";
import { Role } from "@prisma/client";
import passport from "passport";
import { AuthenticatedUser } from "../types/auth"; 

export const sessionGuard = (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  try {
  // Todo: Implement session guard logic
  } catch (error) {
    return res.status(500).json({ message: "Internal server error" });
  }
};

export const roleGuard =
  (roles: Role[]) => (req: Request, res: Response, next: NextFunction) => {
    try {
    // Todo: Implement role guard logic
    } catch (error) {
      return next(error);
    }
},

export const routeGuard =
  (roles: Role[]) => (req: Request, res: Response, next: NextFunction) => {
    try {
    // Todo: Implement route guard logic
    } catch (error) {
      return next(error);
    }
},
`,

  //* File Swagger Utils
  "src/common/utils/swagger.ts": `import swaggerJsdoc from "swagger-jsdoc";
import swaggerUi from "swagger-ui-express";

const swaggerOptions: swaggerJsdoc.Options = {
  definition: {
    openapi: "3.0.0",
    info: {
      title: "Kolexia Doc",
      version: "1.0.0",
      description: "This is documentation of Kolexia project",
    },
    servers: [
      {
        url: "http://localhost:3003",
      },
    ],
  },
  apis: ["./src/**/*.ts"],
};

const swaggerDocs = swaggerJsdoc(swaggerOptions);

export { swaggerUi, swaggerDocs };
`,

  //* File Initialize Test DB
  "src/_tests_/helpers/initialize.db.ts": `import { prisma } from "../../common/database/db";
import bcrypt from "bcrypt";

export const initializeTestDb = async () => {
  await cleanUpTestDb();
  await seedTestDb();
};

const cleanUpTestDb = async () => {
  await prisma.$transaction([
    prisma.session.deleteMany(),
    prisma.user.deleteMany(),
    prisma.admin.deleteMany(),
    prisma.account.deleteMany(),
    // TODO: Add cleanup logic
  ]);
};

const seedTestDb = async () => {
    const userAccount = await prisma.account.create({
    data: {
      id: "clte7m0di0000mp08kxxx1234",
      role: "USER",
    },
  });

  const adminAccount = await prisma.account.create({
    data: {
      id: "clte7m0di0002mp08w3hr3333",
      role: "ADMIN",
    },
  });

  const user = await prisma.user.create({
    data: {
      email: "user.test@email.com",
      password: bcrypt.hashSync("password10", 10),
      name: "User Test",
      accountId: userAccount.id,
      createdAt: new Date(),
      updatedAt: new Date(),
    },
  });

  const admin = await prisma.admin.create({
    data: {
      email: "admin.test@email.com",
      password: bcrypt.hashSync("password", 10),
      name: "Admin Test",
      accountId: adminAccount.id,
      createdAt: new Date(),
      updatedAt: new Date(),
    },
  });

  await prisma.session.create({
    data: {
      id: "clte7m0di0001mp08q2hr2222",
      token: "test_user_token_123",
      expiresAt: new Date(),
      createdAt: new Date(),
      updatedAt: new Date(),
      accountId: userAccount.id,
    },
  });
  // TODO: Add seeding logic
};
`,

  //* Env file
  ".env": `API_PORT=3003
DB_HOST=your_db_host
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=your_db_name
JWT_SECRET=your_jwt_secret
BCRYPT_SALT_ROUNDS=10

DOCKER_DB_PORT=3306
DOCKER_DB_HOST=your_docker_db_host

DATABASE_URL="mysql://your_db_user:your_db_password@your_db_host:3306/your_db_name"
`,

  //* Env Example file
  ".env.example": `API_PORT=your_api_port
DB_HOST=your_db_host
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=your_db_name
JWT_SECRET=your_jwt_secret
BCRYPT_SALT_ROUNDS=your_bcrypt_salt_rounds

DOCKER_DB_PORT=your_docker_db_port
DOCKER_DB_HOST=your_docker_db_host`,

  //* Gitignore file
  ".gitignore": `node_modules
dist
.env
  
/src/generated/prisma
`,

  //* Docker-Compose file
  "docker-compose.yml": `version: "3.8"

services:
  # ===================================================================================================================================================================================
  database:
    image: mysql:8.0
    container_name: \${DOCKER_DB_HOST}
    ports:
      - "\${DOCKER_DB_PORT}:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=\${DB_NAME}
      - MYSQL_USER=\${DB_USER}
      - MYSQL_PASSWORD=\${DB_PASSWORD}
    volumes:
      - mysql_data:/var/lib/mysql
    command: --default-authentication-plugin=mysql_native_password
    restart: "always"
  # ===================================================================================================================================================================================

volumes:
  mysql_data:
`,

  //* README file
  "README.md": `# TypeScript Express and Prisma Project

# Setup Instructions
1. Install dependencies:
\`\`\`bash
  npm install
\`\`\`

2. Create Docker MySQL container:
\`\`\`bash
  docker-compose up -d
\`\`\`

3. Run Prisma migrations:
\`\`\`bash
  npx prisma migrate dev --name init
\`\`\`

Or reset database and run all migrations:
\`\`\`bash
  npx prisma migrate reset
\`\`\`

Or generate Prisma client:
\`\`\`bash
  npx prisma generate
\`\`\`

4. Start the development server:
\`\`\`bash
  npm run dev
\`\`\``,
};
